node {

        stage('Checkout') {
            git url: 'https://github.com/basivireddy/microservice-app-example.git', credentialsId: 'github-basivireddy', branch: 'master'
        }

        
	stage('Docker Build and Publish') {
		buildAndPush('basivireddy', "${env.JOB_NAME}", 'v1');
    }
		

	
}


def buildAndPush(registryID, imageName, version){
    def app
    try {
	    dir ('log-message-processor') {
		    
		    app = docker.build("${registryID}/${imageName}")
		
		app.push("${version}.${env.BUILD_NUMBER}")
		
             		    
	    }
	    
	} catch (error){
		sh 'echo "Not able to build and push docker image ${error}"'
	}
}
