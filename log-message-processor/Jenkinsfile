node {

        stage('Checkout') {
            git url: 'https://github.com/basivireddy/microservice-app-example.git', credentialsId: 'github-basivireddy', branch: 'master'
        }

        
	stage('Docker Build and Publish') {
		buildAndPush('private-registry:5000','log-message-processor', 'v1');
        }
		

	
}


def buildAndPush(registryID, imageName, version){
    def app
    try {
	    dir ('log-message-processor') {
		    
	     app = docker.build("${registryID}/${imageName}:${version}.${env.BUILD_NUMBER}")
             app.push()
            //app = docker.build "private-registry:5000/log-message-processor:v1" .
            //app.push()
		    
	    }
	    
	} catch (error){
		sh 'echo "Not able to build and push docker image ${error}"'
	}
}
